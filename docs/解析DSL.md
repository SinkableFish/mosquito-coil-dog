根据我们的设计，MCDog需要解析基于json的DSL。

当使用者（接口规则定制者）将动态定义的服务提交给MCDog后，MCDog会进行最终的有效性校验，方式为解析用户提交的服务DSL片段。一旦校验通过，该服务就会处于激活状态。

而每当MCDog启动后，会从存储中取出所有激活状态的服务配置，然后将它们解析并生成服务。处于解析过程中的服务是无法给客户端调用的，服务的状态迁移如下图：

![](https://github.com/kazaff/mosquito-coil-dog/blob/master/docs/state_machine.png)

解析阶段，不仅会校验服务定义的有效性，还会生成服务的执行逻辑，该执行逻辑用于接受客户端请求。我们需要一种方式来保存解析出来的执行逻辑，每次对该服务的请求都将直接运行该执行逻辑，而不需要重复将服务的DSL进行解析。

我们要怎样用nodejs来表达这种执行逻辑的概念呢？其它语言中类似的场景会采用生成代码片段并动态编译加载，该方案依然适配nodejs。

其实，我们可以在开发环境下搭建MCDog，并将需要的工作流都创建好并设置为上线状态，然后在生产环境跑一套没有管理后台的MCDog，完全不需要在生产环境中搭建Redis（默认的工作流元数据持久化介质）。这是因为，MCDog将上线的工作流解析并生成对应的执行逻辑js文件（放在MCDog目录下的`compiled_services`文件夹中），每次启动MCDog时都会扫描这些文件并直接加载并绑定它们供第三方调用。
